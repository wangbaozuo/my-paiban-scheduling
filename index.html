<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="theme-color" content="#3498db" />
    <meta name="description" content="智能岗位分配系统 - 移动端优化版" />
    <title>智能岗位分配系统 - 全面优化版</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="theme-light">
    <div class="notification-panel" id="notification-panel"></div>
    <div class="container">
        <header>
            <div class="theme-selector">
                <button class="theme-btn light" title="浅色主题" onclick="setTheme('light')"></button>
                <button class="theme-btn dark" title="深色主题" onclick="setTheme('dark')"></button>
                <button class="theme-btn high-contrast" title="高对比度主题" onclick="setTheme('high-contrast')"></button>
            </div>
            <h1><i class="fas fa-building"></i> 智能岗位分配系统 (此脚本由生产部基板裁切AI梦想家开发)</h1>
        </header>
        <div class="content">
            <section class="section">
                <h2><i class="fas fa-users"></i> 员工管理</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="new-employee">添加员工</label>
                        <input type="text" id="new-employee" placeholder="输入姓名后按回车或点击添加" />
                        <button type="button" class="small" id="btn-add-employee" aria-label="添加新员工"><i class="fas fa-plus"></i> 添加</button>
                    </div>
                    <div class="form-group">
                        <label for="excel-import">Excel导入员工</label>
                        <input type="file" id="excel-import" accept=".xlsx,.xls" aria-label="选择Excel文件导入员工列表" />
                        <button type="button" class="small" id="btn-import-excel" aria-label="导入Excel"><i class="fas fa-upload"></i> 导入</button>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>批量操作</label>
                        <button type="button" id="btn-select-all" class="small">全选</button>
                        <button type="button" id="btn-remove-selected" class="danger small" aria-label="删除选中的员工"><i class="fas fa-trash"></i> 删除选中</button>
                        <button type="button" id="btn-reset-all" class="warning small" aria-label="重置员工列表为默认"><i class="fas fa-sync-alt"></i> 重置为默认</button>
                    </div>
                </div>
                <div class="btn-row" style="margin-top: 10px;">
                    <button type="button" id="btn-show-priorities" class="success small" aria-label="设置员工岗位优先级"><i class="fas fa-star"></i> 设置员工岗位优先级</button>
                    <div class="backup-btn-group">
                        <input type="file" id="backup-import" accept=".json" class="backup-file-input" aria-label="导入备份文件" />
                        <button type="button" class="backup-btn export" id="btn-export-backup" aria-label="导出所有数据"><i class="fas fa-download"></i> 导出备份</button>
                        <button type="button" class="backup-btn import" id="btn-import-backup" aria-label="导入数据"><i class="fas fa-upload"></i> 导入备份</button>
                    </div>
                </div>
                <p class="tip">勾选下方名单可进行批量删除。Excel导入支持姓名列（A列）。备份功能将导出/导入所有模块数据（员工、分组、优先级、排班、休息、通知），导入后所有界面将自动刷新显示。</p>
                <input type="search" class="search-input" id="search-delete" placeholder="搜索员工..." aria-label="搜索员工">
                <div class="checkbox-list" id="delete-list"></div>
            </section>
            <section class="section">
                <h2><i class="fas fa-users-cog"></i> 轮休分组设置 (7批，每批3-10人)</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="group-search">搜索可用员工</label>
                        <input type="search" id="group-search" placeholder="搜索员工..." class="search-input">
                    </div>
                    <div class="form-group">
                        <label for="selected-group">目标组</label>
                        <select id="selected-group">
                            <option value="1">A组 (周一)</option>
                            <option value="2">B组 (周二)</option>
                            <option value="3">C组 (周三)</option>
                            <option value="4">D组 (周四)</option>
                            <option value="5">E组 (周五)</option>
                            <option value="6">F组 (周六)</option>
                            <option value="0">G组 (周日)</option>
                        </select>
                        <button type="button" class="small" id="btn-assign-group"><i class="fas fa-arrow-right"></i> 分配选中到组</button>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <button type="button" id="btn-clear-groups" class="warning small"><i class="fas fa-eraser"></i> 清空所有组</button>
                        <button type="button" id="btn-validate-groups" class="success small"><i class="fas fa-check"></i> 验证分组</button>
                    </div>
                </div>
                <div class="checkbox-list" id="group-avail-list"></div>
                <div class="groups-container" id="groups-container"></div>
                <p class="tip">勾选可用员工，选目标组点击分配。目标：每组3-10人，总覆盖率>90%。批量生成时，周几用对应组休息。</p>
            </section>
            <section class="section">
                <h2><i class="fas fa-calendar"></i> 排班日期</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="year">年份</label>
                        <input type="number" id="year" value="2025" min="2020" max="2030" />
                    </div>
                    <div class="form-group">
                        <label for="month">月份</label>
                        <select id="month" aria-label="选择月份"></select>
                    </div>
                    <div class="form-group">
                        <label for="specific-date">具体日期</label>
                        <input type="number" id="specific-date" placeholder="选择日期" min="1" aria-label="输入日期">
                    </div>
                </div>
                <p class="tip">选择年月日后，可生成或查看单日排班。批量生成将忽略具体日期，使用年月生成整月数据。</p>
            </section>
            <section class="section">
                <h2><i class="fas fa-bed"></i> 当日休息员工</h2>
                <div class="btn-row">
                    <button type="button" id="btn-show-rest" aria-label="设置休息人员"><i class="fas fa-check"></i> 设置休息人员</button>
                    <button type="button" id="btn-confirm-rest" class="success" aria-label="确认休息选择"><i class="fas fa-check-circle"></i> 确认选择</button>
                </div>
                <input type="search" class="search-input" id="search-rest" placeholder="搜索员工..." aria-label="搜索休息员工" style="display:none;">
                <div class="checkbox-list" id="rest-list"></div>
                <p class="tip">被选中的员工将不会参与当天岗位分配。</p>
            </section>
            <section class="section">
                <h2><i class="fas fa-ban"></i> 不会刻码人员</h2>
                <div class="btn-row">
                    <button type="button" id="btn-show-no-coding" aria-label="修改不会刻码人员"><i class="fas fa-edit"></i> 修改不会刻码人员</button>
                    <button type="button" id="btn-confirm-no-coding" class="success" aria-label="确认不会刻码选择"><i class="fas fa-check-circle"></i> 确认选择</button>
                </div>
                <input type="search" class="search-input" id="search-no-coding" placeholder="搜索员工..." aria-label="搜索不会刻码员工" style="display:none;">
                <div class="checkbox-list" id="no-coding-list"></div>
                <p class="tip">勾选的员工是不能操作刻码机的人员（永久有效，除非手动修改）。</p>
            </section>
            <section class="section">
                <h2><i class="fas fa-chart-bar"></i> 数据分析仪表板</h2>
                <div class="analytics-dashboard">
                    <div class="chart-row">
                        <div class="chart-container">
                            <canvas id="workload-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="skill-distribution-chart"></canvas>
                        </div>
                    </div>
                    <div class="kpi-cards">
                        <div class="kpi-card">
                            <h3>岗位均衡度</h3>
                            <div id="balance-score">85%</div>
                        </div>
                        <div class="kpi-card">
                            <h3>员工满意度</h3>
                            <div id="satisfaction-score">78%</div>
                        </div>
                        <div class="kpi-card">
                            <h3>排班完成率</h3>
                            <div id="completion-rate">92%</div>
                        </div>
                        <div class="kpi-card">
                            <h3>技能匹配度</h3>
                            <div id="skill-match">88%</div>
                        </div>
                    </div>
                </div>
                <div class="ai-suggestions" id="ai-suggestions">
                    <h3><i class="fas fa-robot"></i> AI优化建议</h3>
                    <div id="suggestions-list">
                        <!-- AI建议将动态加载到这里 -->
                    </div>
                </div>
            </section>
            <section class="section">
                <h2><i class="fas fa-user-check"></i> 员工自助服务</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="employee-self-lookup">查询我的排班</label>
                        <input type="text" id="employee-self-lookup" placeholder="输入您的姓名" />
                        <button type="button" class="small" id="btn-lookup-schedule"><i class="fas fa-search"></i> 查询</button>
                    </div>
                </div>
                <div id="self-service-panel" style="display:none;">
                    <div class="my-schedule">
                        <h4>我的今日排班</h4>
                        <div id="my-schedule-details"></div>
                    </div>
                    <div class="request-form">
                        <h4>换班申请</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="request-date">申请日期</label>
                                <input type="number" id="request-date" placeholder="日期" min="1" max="31" />
                            </div>
                            <div class="form-group">
                                <label for="request-reason">申请原因</label>
                                <select id="request-reason">
                                    <option value="personal">个人原因</option>
                                    <option value="sick">生病</option>
                                    <option value="emergency">紧急情况</option>
                                    <option value="other">其他</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <textarea id="request-details" placeholder="申请详情..."></textarea>
                        </div>
                        <button type="button" id="btn-submit-request" class="small">提交申请</button>
                    </div>
                </div>
            </section>
            <section class="section">
                <h2><i class="fas fa-cogs"></i> 操作面板</h2>
                <div class="btn-row">
                    <button type="button" id="btn-generate" class="success" aria-label="生成当天排班"><i class="fas fa-rocket"></i> 生成当天排班</button>
                    <button type="button" id="btn-monthly-generate" class="success" aria-label="一键生成本月排班"><i class="fas fa-calendar-alt"></i> 🌕 一键生成本月排班</button>
                </div>
                <div class="btn-row">
                    <button type="button" id="btn-reset-schedule" class="warning" disabled aria-label="重置排班"><i class="fas fa-sync-alt"></i> 重置排班</button>
                    <button type="button" id="btn-export" disabled aria-label="打印排班表"><i class="fas fa-print"></i> 打印排班表</button>
                    <button type="button" id="btn-export-excel" disabled aria-label="导出Excel"><i class="fas fa-file-excel"></i> 导出Excel</button>
                </div>
                <div id="progress">
                    <div>📊 正在智能分配岗位...</div>
                    <progress id="progress-bar" value="0" max="100"></progress>
                </div>
                <h3 style="margin-top: 20px;"><i class="fas fa-clipboard-list"></i> 岗位分配预览</h3>
                <div id="preview"><em>请选择完整的年月日以查看或生成排班。</em></div>
            </section>
            <section class="section">
                <h2><i class="fas fa-calendar-week"></i> 本月全部排班预览表</h2>
                <div class="btn-row" style="margin-bottom: 15px;">
                    <button type="button" id="btn-expand-all" class="success small" style="display:inline-block;"><i class="fas fa-expand-arrows-alt"></i> 展开全部</button>
                    <button type="button" id="btn-collapse-all" class="warning small" style="display:none;"><i class="fas fa-compress-arrows-alt"></i> 折叠全部</button>
                </div>
                <div id="monthly-preview"><em>点击"一键生成本月排班"生成后显示全部月度排班详情。</em></div>
            </section>
            <section class="section">
                <h2><i class="fas fa-history"></i> 历史排班追溯与统计</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="hist-year">年份</label>
                        <input type="number" id="hist-year" value="2025" min="2020" max="2030" />
                    </div>
                    <div class="form-group">
                        <label for="hist-month">月份</label>
                        <select id="hist-month" aria-label="选择历史月份"></select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="hist-employee">员工统计</label>
                        <input type="text" id="hist-employee" placeholder="输入员工姓名查询" />
                        <button type="button" class="small" id="btn-hist-employee">🔍 查询员工</button>
                    </div>
                </div>
                <div class="btn-row">
                    <button type="button" id="btn-hist-view" class="success">📅 查看月度概览</button>
                    <button type="button" id="btn-hist-rest-rank" class="warning">📊 休息天数排行</button>
                </div>
                <div id="history-preview" class="history-container"><em>选择年月以查看历史排班概览。</em></div>
            </section>
        </div>
    </div>
    <div id="priority-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" id="btn-close-modal">&times;</span>
            <h2><i class="fas fa-star"></i> 员工岗位优先级设置</h2>
            <p class="tip">设置员工对每个岗位的偏好分数（建议0-5分）。分数越高，算法在分配该岗位时越优先考虑该员工。这是"智能排班"的核心！实时同步所有模块数据。</p>
            <div id="priority-table-container">
                <p>正在加载员工数据...</p>
            </div>
            <div class="btn-row" style="margin-top: 20px; justify-content: flex-end;">
                <button type="button" id="btn-save-priorities" class="success"><i class="fas fa-save"></i> 保存设置</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>